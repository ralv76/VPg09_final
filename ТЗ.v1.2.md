# Техническое задание: Платформа для создания AI-подкастов из текста

## 1. Введение

### 1.1. Наименование проекта
«Генератор подкастов» — веб-платформа для автоматизированного создания аудиоподкастов из текстовых материалов.

### 1.2. Краткое описание проекта
Web-платформа, которая преобразует текстовые материалы (PDF, DOCX, веб-статьи) в профессиональные аудиоподкасты с использованием искусственного интеллекта. Система автоматически создает диалоговые сценарии, генерирует естественные голоса, добавляет фоновую музыку и создает обложки для подкастов.

### 1.3. Цели проекта
-   **Образовательная**: Освоить работу с TTS API, обработку аудио, создание AI-сценариев и автоматизацию креативных процессов
-   **Продуктовая**: Создать работающий MVP за 2 недели для демонстрации в портфолио
-   **Техническая**: Реализовать полный конвейер обработки данных от текста до готового подкаста
    
### 1.4. Основные пользовательские сценарии
1.  **Контент-маркетолог**: Преобразует статьи блога в подкасты для расширения аудитории
2.  **Преподаватель**: Создает аудиоверсии лекций для студентов
3.  **Медиа-редактор**: Автоматизирует производство регулярных подкаст-выпусков
4.  **Блогер**: Диверсифицирует контент, создавая аудиоверсии текстовых постов

## 2. Общее описание

### 2.1. Функциональные требования

#### 2.1.1. Этап 1: Извлечение текста
-   **MVP**: Парсинг текста из PDF и DOCX файлов — без обращения к внешним API
-   **MVP**: Извлечение контента с URL (текст с веб-страниц)
-   **MVP**: Обратная связь при загрузке: сообщение о получении файла, статус «идёт обработка» или «ошибка», чтобы пользователь понимал, что происходит
-   **MVP**: Автоизвлечение текста после загрузки файла или ввода URL; отображение извлечённого текста без отдельной кнопки «Извлечь текст» (на локальном этапе допускается выводить весь текст)
-   **MVP**: Анализ и удаление персональных данных: маски для разнообразных форматов написания номеров телефонов (в т.ч. +7, 8, скобки, пробелы, дефисы, международные); контакты с символом @ определяются по наличию @, удаляется фрагмент «слово слева от @» и «слово справа от @» (защита email и адресов вида Telegram и т.д.)
-   **MVP**: Информирование пользователя: если какие-либо данные были удалены (телефоны, контакты с @), выводить сообщение об этом
-   **MVP**: Очистка и базовое форматирование текста
-   **Будущее**: Поддержка EPUB, TXT, изображений с OCR, в том числе с PDF в виде картинок
-   **Будущее**: Структурированное извлечение (заголовки, списки)

#### 2.1.2. Этап 2: AI-сценарий
-   **MVP**: Промпты для трансформации текста в диалог (2 участника)
-   **MVP**: Генерация сценария с несколькими ведущими с использованием API LLM
-   **MVP**: Естественные переходы между темами
-   **Будущее**: Выбор разных форматов (интервью, дискуссия, монолог)
-   **Будущее**: Настройка характеров участников диалога
-   **Будущее**: Выбор модели LLM для генерации сценария
-   **Будущее**: Многоэтапный (двух и более) вариант генерации сценария
-   **Будущее**: Выходной контроль сгенерированного текста с приёмкой или отказом с замечаниями

#### 2.1.3. Этап 3: Синтез речи
-   **MVP**: Интеграция одного TTS API
-   **MVP**: Список голосов ведущих получать из модели/API (если API поддерживает), иначе — fallback-список
-   **MVP**: После получения списка голосов — возможность прослушать краткую фразу-пример для выбранного голоса перед генерацией подкаста
-   **MVP**: Настройка скорости голоса при создании подкаста
-   **MVP**: Выбор из 3–4 голосов (мужской/женский)
-   **MVP**: Базовая обработка и склейка аудио
-   **Будущее**: Интеграция нескольких TTS провайдеров
-   **Будущее**: Регулировка темпа, тона, эмоций
-   **Будущее**: Выбор языка для подкаста

#### 2.1.4. Этап 4: Frontend
-   **MVP**: Интерфейс загрузки материалов (drag & drop и выбор из списка)
-   **MVP**: Настройки голосов и стиля
-   **MVP**: Preview результата и прогресс-бар генерации
-   **Будущее**: История созданий, сохранение проектов
-   **Будущее**: Продвинутые настройки звука

#### 2.1.5. Этап 5: Музыка и обложка
-   **MVP**: Библиотека из 5–10 фоновых музыкальных треков
-   **MVP**: Возможность прослушать выбранный трек перед нажатием «Генерация»
-   **MVP**: Базовое микширование (голос + музыка)
-   **MVP**: AI-генерация обложек по тексту (API)
-   **Будущее**: Кастомизация громкости музыки
-   **Будущее**: Загрузка собственной музыки и изображений

#### 2.1.6. Этап 6: RSS и экспорт
-   **MVP**: Генерация RSS-ленты для подкаста
-   **MVP**: Экспорт аудиофайла (MP3) и обложки (JPG)
-   **MVP**: Хостинг файлов на период демонстрации
-   **Будущее**: Автопубликация в подкаст-платформы
-   **Будущее**: Статистика прослушиваний

#### 2.1.7. Этап 7: Деплой и оптимизация
-   **MVP**: Развертывание на облачном хостинге
-   **MVP**: Базовая очередь задач для обработки
-   **MVP**: Оптимизация затрат на API (лимиты)
-   **Будущее**: Мониторинг и алертинг
-   **Будущее**: Автоскейлинг ресурсов

### 2.2. Нефункциональные требования

#### 2.2.1. Требования к производительности
-   **MVP**: Время генерации подкаста до 5 минут для текста 5000 символов
-   **Будущее**: Поддержка одновременной обработки 10+ запросов
-   **Будущее**: Время отклика интерфейса < 2 секунд

#### 2.2.2. Требования к надежности
-   **MVP**: Сохранение состояния задачи при перезагрузке
-   **MVP**: Резервное копирование пользовательских данных
-   **Будущее**: Доступность 90%
-   **Будущее**: Восстановление после сбоев API-провайдеров

#### 2.2.3. Требования к безопасности
-   **MVP**: Безопасное хранение API-ключей (environment variables)
-   **MVP**: Валидация входных данных (файлы, URL, объемы данных)
-   **Будущее**: Аутентификация пользователей (OAuth 2.0)
-   **Будущее**: Шифрование данных при передаче и хранении

#### 2.2.7. Защита входа
-   **MVP**: Один общий логин и пароль для входа в приложение (без регистрации; кнопка регистрации отсутствует или отключена).
-   **MVP**: Сгенерированные файлы для RSS (MP3, обложка, RSS-файл) доступны по прямой ссылке без авторизации — для корректной работы подкаст-агрегаторов и воспроизведения по публичным URL.

#### 2.2.4. Требования к удобству использования
-   **MVP**: Интуитивный интерфейс без необходимости обучения
-   **MVP**: Подробные сообщения об ошибках
-   **MVP**: Адаптивный дизайн (работа на мобильных устройствах)

#### 2.2.5. Требования к совместимости
-   **MVP**: Поддержка современных браузеров (Chrome 90+, Firefox 88+, Safari 14+)
-   **MVP**: Поддержка форматов: MP3 (аудио), JPG/PNG (обложки), RSS 2.0
    

#### 2.2.6. Требования к поддерживаемости
-   **MVP**: Чистая модульная архитектура кода
-   **MVP**: Подробное логирование процессов
-   **Будущее**: Документация API для расширения функционала
-   **Будущее**: Система сбора обратной связи

### 2.3. Ограничения
-   Взаимодействие со всеми API осуществляется через кастомный URL
-   Срок реализации: 2 недели
-   Бюджет API: не более 10$ на период разработки и демонстрации
-   Команда: 1 разработчик (студент курса)
-   Требования к хостингу: VDS RUSONIX
-   Лицензии на музыку: только бесплатные/открытые треки

### 2.4. Предположения и зависимости

-   **Предположения**:
    -   Пользователи имеют базовое понимание, что такое подкаст
    -   Основной контент — текстовые статьи и публикации
    -   Качество AI-голосов приемлемо для образовательных/информационных целей
        
-   **Зависимости**:
    -   Доступность и стабильность внешних API (TTS, генерация изображений)
    -   Интернет-соединение у пользователя
    -   Соблюдение лицензионных соглашений используемых сервисов

## 3. Детальные требования к функциональности

### 3.1. Этап 1: Извлечение текста

**Входные данные**:
-   Файлы: PDF, DOCX (до 10 МБ)
-   URL: публичные веб-страницы

**Ожидаемый результат**:
-   Чистый текст, готовый для обработки AI
-   Сохранение структуры (абзацы, заголовки)

### 3.2. Этап 2: AI-сценарий

**Параметры настройки**:
-   Формат: Диалог (2 участника) / Монолог
-   Стиль: Формальный / Разговорный / Энергичный
-   Длительность: Сверхкороткий (до 1 мин) / Краткий (3–5 мин) / Стандартный (7–10 мин)

**Качество сценария**:
-   Естественные реплики, вопросы, переходы
-   Сохранение ключевых идей исходного текста

### 3.3. Этап 3: Синтез речи

**Характеристики голосов**:
-   Список голосов получать из модели/API, при недоступности — fallback-список (минимум 2 мужских и 2 женских)
-   Краткие фразы-примеры для прослушивания выбранного голоса перед генерацией
-   Настройка скорости речи (например, 0.5–2.0)
-   Естественное звучание (нейронный TTS)

**Формат вывода**:
-   Аудиофайл MP3, битрейт 128 kbps; итоговый файл mixed.mp3 (склейка по голосам в один трек)
-   Раздельные дорожки для каждого голоса (voice_1.mp3, voice_2.mp3 в каталоге задачи) для постобработки

### 3.4. Этап 4: Frontend

**Страницы интерфейса**:
1.  **Главная**: Описание возможностей, кнопка начала
2.  **Создание подкаста**:
    -   Шаг 1: Загрузка контента
    -   Шаг 2: Настройки сценария и голосов
    -   Шаг 3: Выбор музыки и генерация обложки
3.  **Результат**: Аудиоплеер, обложка (или сообщение «Обложка не сгенерирована»), кнопки скачивания MP3, обложки и RSS
4.  **Подкасты** (v1.2): Список всех сгенерированных подкастов с переходом на страницу результата; ссылка в шапке сайта

**Элементы управления**:
-   Обратная связь при загрузке файла: «Файл получен», «Обработка…», «Готово» или сообщение об ошибке
-   Автоизвлечение и отображение текста после загрузки (без отдельной кнопки извлечения)
-   Сообщение об удалённых персональных данных (телефоны, контакты с @), если такие были обнаружены
-   Прогресс-бар с этапами генерации; обновление статуса по опросу API (раз в 1 с); при завершении задачи — автоматический переход на страницу результата; при отсутствии идентификатора задачи (task_id) в ответе сервера — явное сообщение об ошибке
-   Предпросмотр текста после очистки
-   Кнопка отмены процесса

### 3.5. Этап 5: Музыка и обложка

**Музыкальная библиотека**:
-   5–10 треков разных жанров (фоновые, нейтральные)
-   Прослушивание выбранного трека перед запуском генерации подкаста
-   Автоматический подбор музыки по стилю и скорости: при выборе «Автовыбор по стилю» — энергичный стиль или ускорение воспроизведения → melody_piano_fast.mp3, иначе → melody_piano.mp3; вариант «Без мелодии» сохранён

**Генерация обложки**:
-   AI создает изображение на основе ключевых слов текста
-   Стандартный размер: 1024×1024 пикселей (для подкаст-платформ)
-   Возможность повторной генерации с уточнением инструкций промпта запроса
-   Совместимость с прокси-API (proxyapi.ru и аналоги): при ответе 400 повтор запроса без неподдерживаемых параметров (response_format, model); поддержка моделей dall-e-3, dall-e-2, gpt-image-1, gpt-image-1.5 с настройкой качества (например, low)

### 3.6. Этап 6: RSS и экспорт

**Содержимое RSS**:
-   Заголовок подкаста (из текста)
-   Описание (автогенерируемое)
-   Ссылка на аудиофайл
-   Обложка
-   Длительность, дата публикации

**Экспорт**:
-   MP3 файл с метаданными (ID3 теги)
-   JPG обложка
-   RSS файл для импорта в агрегаторы

### 3.7. Этап 7: Деплой и оптимизация

**Инфраструктура**:
-   Frontend: подсчет статики
-   NGINX
-   Хранилище файлов: локальный каталог на сервере с ограничением доступа не через Backend
-   Контроль пользователя: не root

**Оптимизация**:
-   Кэширование повторяющихся запросов
-   Очередь задач для длительных операций
-   Лимиты на длину текста в бесплатном режиме

## 4. Требования к интерфейсу

### 4.1. Пользовательский интерфейс

**Дизайн-система**:
-   Современный минималистичный дизайн
-   Цветовая схема: синяя (технологичность) с акцентами
-   Шрифты: система sans-serif (Inter, Roboto)

**Компоненты**:
-   Карточки для каждого этапа
-   Четкая навигация (шаги, хлебные крошки)
-   Информативные уведомления и подсказки

### 4.2. Программные интерфейсы (API)

**Внешние API**:
-   TTS: Сервисы OpenAPI. Модель, кастомный URL и API_KEY настраиваются.
-   Генерация изображений: Сервисы OpenAPI. Модель, кастомный URL и API_KEY настраиваются.
-   (Опционально) LLM для сценариев: Сервисы OpenAPI. Модель, кастомный URL и API_KEY настраиваются.

**Внутренняя архитектура**:
-   REST API для взаимодействия фронтенда и бэкенда
-   WebSocket для обновления прогресса в реальном времени
-   Модульная структура

## 5. Требования к данным

### 5.1. Структура данных

**Модели данных**:
-   Пользовательская сессия (анонимная)
-   Задача генерации подкаста
-   Результат (ссылки на файлы, метаданные)

**Хранение**:
-   Сессии и задачи: база данных (SQLite)
-   Временные файлы: облачное хранилище / локальная файловая система

### 5.2. Политика хранения данных
-   Временные файлы удаляются через 7 дней (настраивается FILE_RETENTION_DAYS)
-   Метаданные задач хранятся 7 дней (TASK_METADATA_DAYS)
-   Логи обработки хранятся 30 дней (LOG_RETENTION_DAYS)
-   Автоматическая очистка: фоновый процесс приложения раз в 24 часа и/или скрипт scripts/cleanup_retention.py для запуска по cron

## 6. Требования к развертыванию и поддержке

### 6.1. Условия развертывания

**Среда разработки**:
-   ОС локальной разработки: Win10
-   ОС серверная: Ubuntu 20.04
-   Python 3.10+/Flask/Bootstrap
-   Docker 
-   Git для контроля версий
-   GitHub (внешнее требование)

**Деплой** (подготовка, обязательно для периода промышленной эксплуатации):
-   Автоматический деплой из main ветки
-   Отдельные окружения: development, production
-   Переменные окружения для конфигурации
-   Публичный URL: в .env задаётся BASE_URL (или PUBLIC_URL) без завершающего слэша (например, https://podcast.example.com); используется при формировании ссылок в RSS и в ответах API (mp3_url, cover_url, rss_url)

### 6.2. Условия поддержки

**На период учебного проекта**:
-   Поддержка в течение 2 недель после сдачи
-   Базовый мониторинг доступности
-   Резервные копии конфигурации

**Промышленная эксплуатация**:
-   SLA 90% доступности
-   Техническая поддержка - не нормирована
    
## 7. Критерии приемки

### 7.1. Функциональные критерии
1.  Пользователь может загрузить PDF и получить подкаст за 5-10 минут
2.  Сгенерированный подкаст содержит диалог двух разных голосов
3.  В подкасте присутствует фоновая музыка (регулируемая громкость)
4.  Создается RSS-лента, валидная для подкаст-платформ
5.  Интерфейс отображает прогресс генерации на всех этапах

### 7.2. Технические критерии
1.  Код размещен в публичном GitHub репозитории
2.  Проект развернут и доступен онлайн
3.  Документация включает инструкцию по запуску локально
4.  Приложение обрабатывает ошибки API с корректными сообщениями и рекомендциями
5.  Отсутствуют утечки памяти при длительной работе
6.  Обеспечивается автоматическое восстановление сервиса при перезагрузке сервера

### 7.3. Критерии сдачи курса
1.  Предоставлено ТЗ (данный документ)
2.  GitHub репозиторий с исходным кодом
3.  12+ скриншотов интерфейса
4.  3-5 примеров готовых подкастов
5.  Демо-доступ к работающей платформе
6.  Видео-презентация 6-8 минут

## 8. Риски и меры по их снижению

### 8.1. Технические риски
| Риск | Вероятность | Влияние | Меры снижения |
|------|-------------|---------|---------------|
| Превышение бюджета API | Высокая | Высокое | Лимиты запросов, кэширование, fallback-режимы |
| Длительная генерация | Средняя | Среднее | Прогресс-бар, асинхронная обработка |
| Нестабильность внешних API | Средняя | Высокое | Ретри, очередь отложенных задач |

### 8.2. Продуктовые риски
| Риск | Вероятность | Влияние | Меры снижения |
|------|-------------|---------|---------------|
| Низкое качество AI-диалога | Высокая | Высокое | Тестирование промптов, ручная корректировка |
| Сложность интерфейса | Средняя | Среднее | Юзабилити-тестирование, упрощение |
| Юридические вопросы (музыка) | Низкая | Высокое | Использование только лицензионно-чистого контента |

## 9. Глоссарий
-   **TTS (Text-to-Speech)** — технология преобразования текста в речь
-   **LLM (Large Language Model)** — большая языковая модель для генерации текста
-   **RSS (Really Simple Syndication)** — формат для распространения подкастов
-   **MVP (Minimum Viable Product)** — минимально жизнеспособный продукт
-   **SLA (Service Level Agreement)** — соглашение об уровне обслуживания
-   **Агрегатор подкастов** — платформа для распространения подкастов (Яндекс.Музыка, Apple Podcasts)
----------

**Дата составления**: 09.02.2026  
**Версия документа**: 1.2  

**Изменения в 1.1**: обратная связь при загрузке и автоизвлечение текста; расширенный анализ ПД (телефоны в разных форматах, контакты с @) с информированием пользователя; длительность «до 1 минуты»; список голосов из модели/API; превью голоса (краткая фраза); настройка скорости речи; прослушивание музыки перед генерацией.

**Изменения в 1.2** (доработки интерфейса, прогресса и генерации изображений):

- **Шаг 3 — музыка**: в выпадающем списке опция «Автовыбор» заменена на «Без мелодии»; по умолчанию подкаст создаётся без фоновой музыки (музыка подключается только при явном выборе трека).
- **Шаг 3 — кнопка «Запустить генерацию»**: блокируется на время выполнения задачи и разблокируется при завершении (успех/ошибка/отмена) или при ошибке создания задачи.
- **Отображение прогресса и статуса**:
  - опрос статуса задачи раз в 1 с с защитой от кэширования (заголовки и параметр в URL);
  - при получении ответа «completed» или при наличии поля `result` выполняется немедленный переход на страницу результата;
  - сообщения об ошибках WebSocket (в т.ч. «task_id required») не перезаписывают статус; опрос REST API остаётся основным источником данных;
  - при отсутствии в ответе создания задачи поля `task_id` показывается явная ошибка и опрос не запускается; поддержано чтение `task_id` в вариантах `task_id` / `taskId` для совместимости;
  - в интерфейсе добавлена отладочная строка (последний ответ API); расширено логирование в консоль браузера и в лог бэкенда (GET/POST задач, этапы пайплайна) для диагностики.
- **Страница «Подкасты»**: в шапке сайта добавлена ссылка «Подкасты»; страница `/podcasts` выводит список всех сгенерированных подкастов с переходом на страницу результата (прослушивание, скачивание MP3/обложки/RSS).
- **Генерация обложки (API изображений)**:
  - поддержка прокси (в т.ч. proxyapi.ru): при ответе 400 «Unknown parameter: response_format» повтор запроса без параметра `response_format`; при «Model not supported» — повтор без параметра `model`;
  - поддержка модели `gpt-image-1.5` с параметром качества `low` по умолчанию; опциональная переменная окружения `OPENAPI_IMAGE_QUALITY` (low/medium/high);
  - в `.env.example` указаны рекомендуемые модели (dall-e-3, dall-e-2, gpt-image-1, gpt-image-1.5).
- **Результат и хранение**: при отсутствии обложки в ответе API не отдаётся `cover_url`; на странице результата отображается «Обложка не сгенерирована» и скрывается кнопка скачивания обложки; расширено логирование сохранения результата (result_id, пути к mp3/cover/rss) в пайплайне и воркере.
- **3.3 Раздельные дорожки по голосам**: в каталоге задачи сохраняются voice_1.mp3 и voice_2.mp3 (дорожки по каждому голосу) в дополнение к итоговому mixed.mp3 для постобработки.
- **3.5 Подбор музыки по стилю/скорости**: добавлена опция «Автовыбор по стилю»; при энергичном стиле или ускорении воспроизведения выбирается melody_piano_fast.mp3, иначе melody_piano.mp3; вариант «Без мелодии» сохранён.
- **5.2 Удаление по расписанию**: реализована автоматическая очистка по срокам из конфига (FILE_RETENTION_DAYS, TASK_METADATA_DAYS, LOG_RETENTION_DAYS): фоновый процесс раз в 24 часа и скрипт scripts/cleanup_retention.py для cron.
- **2.2.7 Защита входа**: один логин/пароль (по умолчанию test/test), без регистрации; страница входа /login; сгенерированные файлы для RSS (MP3, обложка, RSS) доступны по прямой ссылке без авторизации.
- **Публичный URL (BASE_URL)**: в конфиге и .env.example добавлена переменная BASE_URL; используется в пайплайне при формировании RSS и в API при сборке mp3_url, cover_url, rss_url для продакшена.